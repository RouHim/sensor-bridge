<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link href="lcd_preview.css" rel="stylesheet"/>
</head>

<script>
    // Tauri v2 API syntax
    const {invoke} = window.__TAURI__.core;

    // Set the preview image on page load
    set_lcd_preview_image();

    // Set the preview image every second
    setInterval(set_lcd_preview_image, 2500);

    /// Set the preview image
    function set_lcd_preview_image() {
        // Load the current mac address from the url after the # symbol
        const macAddress = window.location.hash.substr(1);

        console.log("macAddress: " + macAddress);

        // If no mac address is provided, we can't get the preview
        if (!macAddress) {
            console.error("No MAC address provided in URL hash");
            return;
        }

        invoke('get_lcd_preview_image', {macAddress: macAddress}).then(
            (preview_image) => {
                const img = document.getElementById("lcd-preview-image");
                img.src = "data:image/jpeg;base64," + preview_image;
            }
        ).catch((error) => {
                console.error("Error getting lcd preview image: ", error);
                // Show error in the UI as well
                const img = document.getElementById("lcd-preview-image");
                img.alt = "Error loading preview: " + error;
            }
        );
    }
</script>


<body style="background-color: #000000">
<img id="lcd-preview-image"/>
</body>
</html>
